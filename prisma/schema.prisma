// Prisma schema for Grate Bangla News Backend
// Converted from Drizzle ORM schemas

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ===========================================
// CORE MODELS
// ===========================================

// Categories table - for organizing news by sections
model Category {
  id           Int      @id @default(autoincrement())
  name         String // Default name (Bengali)
  description  String? // Default description in Bengali
  image        String? // Banner image or thumbnail
  names        Json? // { "en": "Politics", "hi": "राजनीति" }
  descriptions Json? // { "en": "Political news", "hi": "राजनीतिक समाचार" }
  slug         String   @unique
  parentId     Int?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  depth        Int      @default(0) // 0 = root, 1 = category, 2 = subcategory
  path         String? // e.g., "politics/national/parliament" for breadcrumbs
  seo          Json? // { "title": "...", "description": "...", "keywords": "..." }
  meta         Json? // { "icon": "...", "color": "...", "custom": {...} }
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  parent   Category?  @relation("CategoryParent", fields: [parentId], references: [id])
  children Category[] @relation("CategoryParent")
  articles Article[]

  @@index([slug])
  @@index([name])
  @@index([isActive])
  @@index([parentId])
  @@index([depth])
  @@index([path])
  @@map("categories")
}

// Users table - for authors, editors, admins
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  bio       String?
  avatar    String?
  role      String   @default("reporter") // admin, editor, reporter, contributor
  isActive  Boolean  @default(true)
  meta      Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  articles Article[]

  @@index([email])
  @@index([role])
  @@index([name])
  @@map("users")
}

// Tags table - for tagging articles
model Tag {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  slug      String   @unique
  isActive  Boolean  @default(true)
  meta      Json? // { "color": "...", "icon": "...", "custom": {...} }
  createdAt DateTime @default(now())

  // Relations
  articleTags ArticleTag[]

  @@index([name])
  @@index([slug])
  @@map("tags")
}

// Languages table - for managing supported languages
model Language {
  id        Int      @id @default(autoincrement())
  code      String   @unique // 'bn', 'en', 'hi'
  name      String // 'Bengali', 'English', 'Hindi'
  direction String   @default("ltr") // 'ltr' or 'rtl'
  isDefault Boolean  @default(false)
  isActive  Boolean  @default(true)
  meta      Json? // { "flag": "...", "locale": "...", "custom": {...} }
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  articles            Article[]
  articleTranslations ArticleTranslation[]

  @@index([code])
  @@index([isActive])
  @@index([isDefault])
  @@map("languages")
}

// Settings table - for persisting application settings / schemaless data
model Setting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
  @@map("settings")
}

// ===========================================
// CONTENT MODELS
// ===========================================

// Articles table - main news articles
model Article {
  id            Int       @id @default(autoincrement())
  title         String
  slug          String    @unique
  excerpt       String?
  content       Json?
  languageId    Int
  featuredImage String?
  imageCaption  String?
  gallery       String[] // Array of image strings
  categoryId    Int?
  authorId      Int?
  status        String    @default("draft") // draft, review, published, archived
  isPublished   Boolean   @default(false)
  publishedAt   DateTime?
  scheduledAt   DateTime? // For scheduled publishing
  seo           Json? // { "title": "...", "description": "...", "keywords": "..." }
  meta          Json? // { "author": "...", "tags": [...], "custom": {...} }
  viewCount     Int       @default(0)
  likeCount     Int       @default(0)
  commentCount  Int       @default(0)
  isFeatured    Boolean   @default(false) // For homepage highlight
  isBreaking    Boolean   @default(false) // Breaking news
  priority      Int       @default(5) // 1-10, higher = more important
  location      String? // Where the news happened
  source        String? // News source/agency
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  language     Language             @relation(fields: [languageId], references: [id])
  category     Category?            @relation(fields: [categoryId], references: [id])
  author       User?                @relation(fields: [authorId], references: [id])
  tags         ArticleTag[]
  comments     Comment[]
  translations ArticleTranslation[]

  @@index([slug])
  @@index([status])
  @@index([isPublished, publishedAt])
  @@index([categoryId])
  @@index([authorId])
  @@index([isFeatured])
  @@index([isBreaking])
  @@index([createdAt])
  @@index([languageId])
  @@index([isPublished, languageId])
  @@map("articles")
}

// Article tags junction table
model ArticleTag {
  id        Int      @id @default(autoincrement())
  articleId Int
  tagId     Int
  createdAt DateTime @default(now())

  // Relations
  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([articleId, tagId])
  @@index([articleId])
  @@index([tagId])
  @@map("article_tags")
}

// Article translations table for additional language versions
model ArticleTranslation {
  id           Int      @id @default(autoincrement())
  articleId    Int
  languageId   Int
  title        String
  excerpt      String?
  content      Json?
  imageCaption String?
  location     String? // Location in translated language
  seo          Json? // { "title": "...", "description": "...", "keywords": "..." }
  meta         Json? // { "translator": "...", "notes": "...", "custom": {...} }
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  article  Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  language Language @relation(fields: [languageId], references: [id])

  @@unique([articleId, languageId])
  @@index([articleId])
  @@index([languageId])
  @@map("article_translations")
}

// ===========================================
// ENGAGEMENT MODELS
// ===========================================

// Comments table - for article comments
model Comment {
  id          Int      @id @default(autoincrement())
  articleId   Int
  authorName  String
  authorEmail String
  content     String
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@index([authorEmail])
  @@index([createdAt])
  @@map("comments")
}

// ===========================================
// BUSINESS MODELS
// ===========================================

// Newsletter subscriptions
model Newsletter {
  id             Int       @id @default(autoincrement())
  email          String    @unique
  name           String?
  preferences    Json? // Which categories to receive
  isActive       Boolean   @default(true)
  verifiedAt     DateTime?
  unsubscribedAt DateTime?
  createdAt      DateTime  @default(now())

  @@index([email])
  @@index([isActive])
  @@map("newsletters")
}

// Advertisement placements
model Advertisement {
  id          Int       @id @default(autoincrement())
  title       String?
  description String?
  imageUrl    String?
  clickUrl    String?
  position    String // header, sidebar, content, footer
  isActive    Boolean   @default(true)
  impressions Int       @default(0)
  clicks      Int       @default(0)
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime  @default(now())

  @@index([isActive])
  @@index([startDate, endDate])
  @@map("advertisements")
}

// ===========================================
// GALLERY MODELS
// ===========================================

// Gallery table for managing uploaded files
model Gallery {
  id        Int      @id @default(autoincrement())
  fileId    String   @unique // ImageKit file identifier
  url       String // File URL
  type      String // 'image' | 'video'
  createdAt DateTime @default(now())

  @@index([url])
  @@index([type])
  @@index([createdAt])
  @@map("gallery")
}
